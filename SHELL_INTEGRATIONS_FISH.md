# Shell Integrations (Fish)

Shell integration setup for Fish shell. This generates `~/.shell_integrations.fish` that works on both Linux and macOS.

**For Bash/Zsh or Nushell:** See `SHELL_INTEGRATIONS.md` or `SHELL_INTEGRATIONS_NUSHELL.md`

---

## Setup Shell Integrations File

Initialize the shell integrations file with header.

```fish
#!/usr/bin/env fish

cat > ~/.shell_integrations.fish << 'EOF'
# Shell Integrations for Fish
# Generated by init/SHELL_INTEGRATIONS_FISH.md
# Works on Linux and macOS
EOF

echo "✓ Created ~/.shell_integrations.fish"
```

---

## Hook shell integration file

Automatically add sourcing line to Fish config file.

```fish
#!/usr/bin/env fish

# Ensure Fish config directory exists
mkdir -p ~/.config/fish

# Hook for config.fish
if test -f ~/.config/fish/config.fish
  if not grep -q ".shell_integrations.fish" ~/.config/fish/config.fish
    echo "" >> ~/.config/fish/config.fish
    echo "# Source shell integrations" >> ~/.config/fish/config.fish
    echo "test -f ~/.shell_integrations.fish; and source ~/.shell_integrations.fish" >> ~/.config/fish/config.fish
    echo "✓ Added hook to ~/.config/fish/config.fish"
  else
    echo "⊘ Hook already exists in ~/.config/fish/config.fish"
  end
else
  echo "✓ Creating ~/.config/fish/config.fish with hook"
  echo "# Source shell integrations" > ~/.config/fish/config.fish
  echo "test -f ~/.shell_integrations.fish; and source ~/.shell_integrations.fish" >> ~/.config/fish/config.fish
end
```

---

## Add FZF Integration

Add fuzzy finder (fzf) shell integration for Fish.

**Prerequisites:** Install fzf via Homebrew (`brew install fzf`)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# FZF - Fuzzy Finder
if type -q fzf
  fzf --fish | source
end
EOF

echo "✓ Added FZF integration to ~/.shell_integrations.fish"
```

---

## Add Zoxide Integration

Add smart directory jumper (zoxide) integration.

**Prerequisites:** Install zoxide via Homebrew (`brew install zoxide`)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# Zoxide - Smart cd replacement
if type -q zoxide
  zoxide init fish | source
end
EOF

echo "✓ Added Zoxide integration to ~/.shell_integrations.fish"
```

---

## Add Starship Prompt Integration

Add Starship prompt integration.

**Prerequisites:** Install starship via Homebrew (`brew install starship`)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# Starship - Cross-shell prompt
if type -q starship
  starship init fish | source
end
EOF

echo "✓ Added Starship integration to ~/.shell_integrations.fish"
```

---

## Add Direnv Integration

Add direnv for per-directory environment variables.

**Prerequisites:** Install direnv via Homebrew (`brew install direnv`)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# Direnv - Per-directory environment variables
if type -q direnv
  direnv hook fish | source
end
EOF

echo "✓ Added Direnv integration to ~/.shell_integrations.fish"
```

---

## Add FNM Integration

Add Fast Node Manager (fnm) shell integration.

**Prerequisites:** Install fnm (see README.md "Fast Node Manager" task)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# FNM - Fast Node Manager
if type -q fnm
  fnm env --shell fish | source
end
EOF

echo "✓ Added FNM integration to ~/.shell_integrations.fish"
```

---

## Add Homebrew Integration

Add Homebrew to PATH (essential on Linux, useful on macOS).

**Prerequisites:** Install Homebrew (see HOMEBREW.md)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# Homebrew - Package manager
if test -d /home/linuxbrew/.linuxbrew
  # Linux Homebrew
  eval (/home/linuxbrew/.linuxbrew/bin/brew shellenv)
else if test -d /opt/homebrew
  # macOS Apple Silicon
  eval (/opt/homebrew/bin/brew shellenv)
else if test -d /usr/local/Homebrew
  # macOS Intel
  eval (/usr/local/bin/brew shellenv)
end
EOF

echo "✓ Added Homebrew integration to ~/.shell_integrations.fish"
```

---

## Add Rust/Cargo Integration

Add Rust's cargo to PATH.

**Prerequisites:** Install Rustup (see README.md "Rust Toolchain" task)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# Rust/Cargo
if test -d $HOME/.cargo/bin
  fish_add_path $HOME/.cargo/bin
end
EOF

echo "✓ Added Rust/Cargo integration to ~/.shell_integrations.fish"
```

---

## Add Go Integration

Add Go binary path.

**Prerequisites:** Install Go via Homebrew (`brew install go`)

```fish
#!/usr/bin/env fish

cat >> ~/.shell_integrations.fish << 'EOF'

# Go
if test -d $HOME/go/bin
  fish_add_path $HOME/go/bin
end
EOF

echo "✓ Added Go integration to ~/.shell_integrations.fish"
```

---

## Sourcing the Integration File

The hook task automatically adds sourcing to your Fish config. If you prefer to add manually:

**Add to `~/.config/fish/config.fish`:**
```fish
# Source shell integrations
test -f ~/.shell_integrations.fish; and source ~/.shell_integrations.fish
```

---

## Usage with mx

```bash
# Setup base file
mx -f init/SHELL_INTEGRATIONS_FISH.md "Setup Shell Integrations File"

# Hook into Fish config
mx -f init/SHELL_INTEGRATIONS_FISH.md "Hook shell integration file"

# Add specific integrations
mx -f init/SHELL_INTEGRATIONS_FISH.md "Add FZF Integration"
mx -f init/SHELL_INTEGRATIONS_FISH.md "Add Zoxide Integration"
mx -f init/SHELL_INTEGRATIONS_FISH.md "Add Homebrew Integration"

# Check what was added
cat ~/.shell_integrations.fish
```

---

## Testing

Verify integrations are working:

```fish
# Reload your shell
source ~/.config/fish/config.fish

# Test FZF
echo "test" | fzf

# Test Zoxide
z --version

# Test other tools
type fzf zoxide starship direnv
```

---

## Notes

- **Order matters:** Run "Setup Shell Integrations File" first
- **Idempotent:** Safe to re-run tasks (appends to file)
- **Cross-platform:** Works on Linux and macOS
- **Commands checked:** Only loads if command exists using `type -q`
- **PATH management:** Uses `fish_add_path` for PATH additions
- **Config location:** `~/.config/fish/config.fish`

---

## Fish-Specific Features

### Command Existence Check
```fish
if type -q command_name
  # command exists
end
```

### File Existence Check
```fish
if test -f /path/to/file
  # file exists
end
```

### Directory Existence Check
```fish
if test -d /path/to/directory
  # directory exists
end
```

### Adding to PATH
```fish
# Preferred method
fish_add_path /path/to/bin

# Alternative
set -gx PATH /path/to/bin $PATH
```

---

## Troubleshooting

**Integration not working:**
- Check if tool is installed: `type fzf`
- Check if integration file is sourced: `grep shell_integrations ~/.config/fish/config.fish`
- Reload Fish: `exec fish` or restart terminal

**Duplicate entries:**
- If you re-run tasks, integrations will be appended multiple times
- Either start fresh (`rm ~/.shell_integrations.fish`) or manually edit the file

**PATH not updating:**
- Use `fish_add_path` instead of directly modifying `$PATH`
- Check `echo $PATH` to verify
