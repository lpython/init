# Shell Integrations (Bash/Zsh)

Cross-shell integration setup for bash and zsh. This generates `~/.shell_integrations.sh` that works on both Linux and macOS.

**For Fish or Nushell:** See `SHELL_INTEGRATIONS_FISH.md` or `SHELL_INTEGRATIONS_NUSHELL.md`

---

## Setup Shell Integrations File

Initialize the shell integrations file with header and shell detection.

```bash
#!/bin/sh

cat > ~/.shell_integrations.sh << 'EOF'
# Shell Integrations
# Generated by init/SHELL_INTEGRATIONS.md
# Works with bash and zsh

# Detect current shell
if [ -n "$ZSH_VERSION" ]; then
  CURRENT_SHELL="zsh"
elif [ -n "$BASH_VERSION" ]; then
  CURRENT_SHELL="bash"
else
  CURRENT_SHELL="unknown"
fi
EOF

echo "✓ Created ~/.shell_integrations.sh"
```

---

## Hook shell integration file

Automatically add sourcing line to both .bashrc and .zshrc files.

```bash
#!/bin/sh

# Hook for .bashrc
if [ -f "$HOME/.bashrc" ]; then
  if ! grep -q ".shell_integrations.sh" "$HOME/.bashrc"; then
    cat >> "$HOME/.bashrc" << 'EOF'

# Source shell integrations
[ -f "$HOME/.shell_integrations.sh" ] && source "$HOME/.shell_integrations.sh"
EOF
    echo "✓ Added hook to ~/.bashrc"
  else
    echo "⊘ Hook already exists in ~/.bashrc"
  fi
else
  echo "⊘ ~/.bashrc not found, skipping"
fi

# Hook for .zshrc
if [ -f "$HOME/.zshrc" ]; then
  if ! grep -q ".shell_integrations.sh" "$HOME/.zshrc"; then
    cat >> "$HOME/.zshrc" << 'EOF'

# Source shell integrations
[ -f "$HOME/.shell_integrations.sh" ] && source "$HOME/.shell_integrations.sh"
EOF
    echo "✓ Added hook to ~/.zshrc"
  else
    echo "⊘ Hook already exists in ~/.zshrc"
  fi
else
  echo "⊘ ~/.zshrc not found, skipping"
fi
```

---

## Add FZF Integration

Add fuzzy finder (fzf) shell integration with auto-detection.

**Prerequisites:** Install fzf via Homebrew (`brew install fzf`)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# FZF - Fuzzy Finder
if command -v fzf > /dev/null 2>&1; then
  if [ "$CURRENT_SHELL" = "zsh" ]; then
    source <(fzf --zsh)
  elif [ "$CURRENT_SHELL" = "bash" ]; then
    eval "$(fzf --bash)"
  fi
fi
EOF

echo "✓ Added FZF integration to ~/.shell_integrations.sh"
```

---

## Add Zoxide Integration

Add smart directory jumper (zoxide) integration.

**Prerequisites:** Install zoxide via Homebrew (`brew install zoxide`)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# Zoxide - Smart cd replacement
if command -v zoxide > /dev/null 2>&1; then
  eval "$(zoxide init $CURRENT_SHELL)"
fi
EOF

echo "✓ Added Zoxide integration to ~/.shell_integrations.sh"
```

---

## Add Starship Prompt Integration

Add Starship prompt integration.

**Prerequisites:** Install starship via Homebrew (`brew install starship`)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# Starship - Cross-shell prompt
if command -v starship > /dev/null 2>&1; then
  eval "$(starship init $CURRENT_SHELL)"
fi
EOF

echo "✓ Added Starship integration to ~/.shell_integrations.sh"
```

---

## Add Direnv Integration

Add direnv for per-directory environment variables.

**Prerequisites:** Install direnv via Homebrew (`brew install direnv`)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# Direnv - Per-directory environment variables
if command -v direnv > /dev/null 2>&1; then
  eval "$(direnv hook $CURRENT_SHELL)"
fi
EOF

echo "✓ Added Direnv integration to ~/.shell_integrations.sh"
```

---

## Add FNM Integration

Add Fast Node Manager (fnm) shell integration.

**Prerequisites:** Install fnm (see README.md "Fast Node Manager" task)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# FNM - Fast Node Manager
if command -v fnm > /dev/null 2>&1; then
  eval "$(fnm env --use-on-cd)"
fi
EOF

echo "✓ Added FNM integration to ~/.shell_integrations.sh"
```

---

## Add Homebrew Integration

Add Homebrew to PATH (essential on Linux, useful on macOS).

**Prerequisites:** Install Homebrew (see HOMEBREW.md)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# Homebrew - Package manager
if [ -d "/home/linuxbrew/.linuxbrew" ]; then
  # Linux Homebrew
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
elif [ -d "/opt/homebrew" ]; then
  # macOS Apple Silicon
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [ -d "/usr/local/Homebrew" ]; then
  # macOS Intel
  eval "$(/usr/local/bin/brew shellenv)"
fi
EOF

echo "✓ Added Homebrew integration to ~/.shell_integrations.sh"
```

---

## Add Rust/Cargo Integration

Add Rust's cargo to PATH.

**Prerequisites:** Install Rustup (see README.md "Rust Toolchain" task)

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# Rust/Cargo
if [ -d "$HOME/.cargo/bin" ]; then
  export PATH="$HOME/.cargo/bin:$PATH"
fi
EOF

echo "✓ Added Rust/Cargo integration to ~/.shell_integrations.sh"
```

---

## Add Go Integration

Add Go binary path.

```bash
#!/bin/sh

cat >> ~/.shell_integrations.sh << 'EOF'

# Go
if [ -d "$HOME/go/bin" ]; then
  export PATH="$HOME/go/bin:$PATH"
fi
EOF

echo "✓ Added Go integration to ~/.shell_integrations.sh"
```

---

## Sourcing the Integration File

After running the desired integration tasks, add this to your shell config:

**For Zsh** (`~/.zshrc`):
```bash
# Source shell integrations
[ -f "$HOME/.shell_integrations.sh" ] && source "$HOME/.shell_integrations.sh"
```

**For Bash** (`~/.bashrc` or `~/.bash_profile`):
```bash
# Source shell integrations
[ -f "$HOME/.shell_integrations.sh" ] && source "$HOME/.shell_integrations.sh"
```

---

## Testing

Verify integrations are working:

```bash
# Reload your shell
source ~/.zshrc
# or
source ~/.bashrc

# Test FZF
echo "test" | fzf

# Test Zoxide
z --version

# Test other tools
which fzf zoxide starship direnv
```

---

## Notes

- **Order matters:** Run "Setup Shell Integrations File" first
- **Idempotent:** Safe to re-run tasks (appends to file)
- **Cross-platform:** Detects shell and OS automatically
- **Commands checked:** Only loads if command exists
- **For Fish/Nushell:** Use separate integration files (different syntax)

---

## Troubleshooting

**Integration not working:**
- Check if tool is installed: `which <tool>`
- Check if integration file is sourced: `grep shell_integrations ~/.zshrc`
- Reload shell: `exec $SHELL`

**Duplicate entries:**
- If you re-run tasks, integrations will be appended multiple times
- Either start fresh (`rm ~/.shell_integrations.sh`) or manually edit the file
